<template>
  <div v-if="showAgreementModal" class="agreement-modal-overlay">
    <div class="agreement-modal">
      <div class="modal-header">
        <h2>ğŸ“œ DeepSeek å°è¯´ç”Ÿæˆæ¡†æ¶ ç”¨æˆ·åè®®ä¸å…è´£å£°æ˜</h2>
        <div class="scroll-progress">
          <div class="progress-bar">
            <div class="progress-fill" :style="{ width: scrollProgress + '%' }"></div>
          </div>
          <span class="progress-text">å·²é˜…è¯» {{ Math.round(scrollProgress) }}%</span>
        </div>
      </div>

      <div class="modal-content" @scroll="onModalScroll" ref="modalContent">
        <div class="agreement-content">
          <div class="important-note">
            <p>
              <strong>é‡è¦æç¤ºï¼š</strong>åœ¨è®¿é—®æˆ–ä½¿ç”¨æœ¬ç½‘ç«™æä¾›çš„æœåŠ¡å‰ï¼Œè¯·æ‚¨åŠ¡å¿…ä»”ç»†é˜…è¯»å¹¶å……åˆ†ç†è§£æœ¬åè®®å„é¡¹å†…å®¹ã€‚ä¸€æ—¦æ‚¨å¼€å§‹ä½¿ç”¨æœ¬æœåŠ¡ï¼Œå³è¡¨ç¤ºæ‚¨å·²å®Œå…¨åŒæ„å¹¶æ¥å—æœ¬åè®®çš„æ‰€æœ‰æ¡æ¬¾ã€‚å¦‚æœæ‚¨ä¸åŒæ„æœ¬åè®®çš„ä»»ä½•å†…å®¹ï¼Œè¯·ç«‹å³åœæ­¢ä½¿ç”¨æœ¬æœåŠ¡ã€‚
            </p>
          </div>

          <section class="agreement-section">
            <h3>ä¸€ã€ æœåŠ¡æ€§è´¨</h3>
            <p><strong>1.1</strong> æœ¬ç«™æ˜¯ä¸€ä¸ªæŠ€æœ¯å·¥å…·å¹³å°ï¼Œä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªä¾¿æ·çš„å‰ç«¯ç•Œé¢ï¼Œä»¥å¸®åŠ©ç”¨æˆ·é€šè¿‡å…¶è‡ªè¡Œè·å–çš„ã€åˆæ³•çš„ç¬¬ä¸‰æ–¹äººå·¥æ™ºèƒ½APIå¯†é’¥ç”Ÿæˆæ–‡æœ¬å†…å®¹ã€‚</p>
            <p><strong>1.2</strong> æœ¬ç«™ä¸æä¾›ä»»ä½•äººå·¥æ™ºèƒ½å¤§æ¨¡å‹æœåŠ¡ï¼Œä¸æ‹¥æœ‰ã€ä¸è¿è¥ä¹Ÿä¸ä»£è¡¨ä»»ä½•AI APIæä¾›å•†ã€‚æ‰€æœ‰è®¡ç®—ã€å†…å®¹ç”Ÿæˆå’Œæœ€ç»ˆè¾“å‡ºå‡ç”±ç”¨æˆ·é€‰æ‹©çš„ç¬¬ä¸‰æ–¹AIæœåŠ¡æä¾›å•†å®Œæˆã€‚</p>
            <p><strong>1.3</strong> æœ¬ç«™ä¸å­˜å‚¨ã€ä¸ç¼“å­˜ã€ä¸å¤‡ä»½ç”¨æˆ·é€šè¿‡æœ¬å·¥å…·ç”Ÿæˆçš„ä»»ä½•æ–‡æœ¬å†…å®¹ã€‚æ‰€æœ‰ç”Ÿæˆå†…å®¹ä»…åœ¨æ‚¨çš„æµè§ˆå™¨ä¼šè¯ä¸­ä¸´æ—¶æ˜¾ç¤ºï¼Œç”±æ‚¨è‡ªè¡Œè´Ÿè´£ä¿å­˜æˆ–å¤„ç†ã€‚</p>
          </section>

          <section class="agreement-section">
            <h3>äºŒã€ ç”¨æˆ·ä¹‰åŠ¡ä¸è¡Œä¸ºè§„èŒƒ</h3>
            <p><strong>2.1
                APIå¯†é’¥è´£ä»»ï¼š</strong>æ‚¨ç¡®è®¤å¹¶ä¿è¯ï¼Œæ‚¨åœ¨æœ¬ç«™ä½¿ç”¨çš„æ‰€æœ‰APIå¯†é’¥å‡ä¸ºæ‚¨æœ¬äººåˆæ³•è·å–ï¼Œå¹¶å·²éµå®ˆç›¸å…³APIæä¾›å•†çš„æœåŠ¡æ¡æ¬¾ã€‚æ‚¨ç‹¬è‡ªæ‰¿æ‹…å› æ‚¨çš„APIå¯†é’¥ä½¿ç”¨å¼•å‘çš„ä¸€åˆ‡åæœã€‚
            </p>

            <p><strong>2.2 å†…å®¹åˆæ³•æ€§ï¼š</strong>æ‚¨æ‰¿è¯ºä½¿ç”¨æœ¬æœåŠ¡ç”Ÿæˆçš„æ‰€æœ‰å†…å®¹å¿…é¡»éµå®ˆæ‚¨æ‰€åœ¨å›½å®¶/åœ°åŒºä»¥åŠæœåŠ¡æ¶‰åŠå›½å®¶/åœ°åŒºçš„æ‰€æœ‰é€‚ç”¨æ³•å¾‹æ³•è§„ã€‚æ‚¨ä¸¥æ ¼ç¦æ­¢ä½¿ç”¨æœ¬æœåŠ¡ç”Ÿæˆä»¥ä¸‹å†…å®¹ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
            <ul class="prohibited-list">
              <li><strong>å±å®³å›½å®¶å®‰å…¨ï¼š</strong>ç…½åŠ¨åˆ†è£‚å›½å®¶ã€ç ´åå›½å®¶ç»Ÿä¸€ã€æ³„éœ²å›½å®¶ç§˜å¯†ã€é¢ è¦†å›½å®¶æ”¿æƒã€æ¨ç¿»ç¤¾ä¼šä¸»ä¹‰åˆ¶åº¦çš„å†…å®¹ã€‚</li>
              <li><strong>ææ€–ä¸»ä¹‰ä¸æš´åŠ›ï¼š</strong>å®£æ‰¬ææ€–ä¸»ä¹‰ã€æç«¯ä¸»ä¹‰ï¼Œç…½åŠ¨æ°‘æ—ä»‡æ¨ã€æ°‘æ—æ­§è§†ï¼Œæ¸²æŸ“æš´åŠ›ã€è¡€è…¥çš„å†…å®¹ã€‚</li>
              <li><strong>æ·«ç§½è‰²æƒ…ï¼š</strong>åˆ¶ä½œã€ä¼ æ’­æ·«ç§½ã€è‰²æƒ…ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠæœªæˆå¹´äººçš„è‰²æƒ…å†…å®¹ã€‚</li>
              <li><strong>æ¬ºè¯ˆä¸è™šå‡ä¿¡æ¯ï¼š</strong>åˆ¶ä½œã€ä¼ æ’­è™šå‡ä¿¡æ¯ï¼Œæ‰°ä¹±ç»æµç§©åºå’Œç¤¾ä¼šç§©åºï¼Œä¾µçŠ¯ä»–äººçŸ¥è¯†äº§æƒã€å•†ä¸šç§˜å¯†çš„å†…å®¹ã€‚</li>
              <li><strong>ä¾®è¾±è¯½è°¤ï¼š</strong>ä¾®è¾±æˆ–è€…è¯½è°¤ä»–äººï¼Œä¾µå®³ä»–äººåèª‰ã€éšç§ã€è‚–åƒæƒç­‰åˆæ³•æƒç›Šçš„å†…å®¹ã€‚</li>
              <li><strong>å…¶ä»–è¿æ³•ä¿¡æ¯ï¼š</strong>æ³•å¾‹ã€è¡Œæ”¿æ³•è§„ç¦æ­¢çš„å…¶ä»–ä»»ä½•å†…å®¹ã€‚</li>
            </ul>

            <p><strong>2.3
                ç¦æ­¢è§„é¿å®¡æŸ¥ï¼š</strong>æ‚¨æ˜ç¡®æ‰¿è¯ºï¼Œä¸å¾—ä»¥ä»»ä½•å½¢å¼åˆ©ç”¨æœ¬å·¥å…·æ—¨åœ¨è§„é¿æˆ–ç ´åä»»ä½•ç¬¬ä¸‰æ–¹AIæœåŠ¡æä¾›å•†å†…ç½®çš„å†…å®¹å®‰å…¨ç­–ç•¥ã€å®¡æŸ¥æœºåˆ¶æˆ–ä½¿ç”¨é™åˆ¶ã€‚
            </p>
          </section>

          <section class="agreement-section">
            <h3>ä¸‰ã€ å…è´£å£°æ˜</h3>
            <p><strong>3.1
                å†…å®¹è´£ä»»è±å…ï¼š</strong>ç”±äºæœ¬ç«™ä¸å‚ä¸ã€ä¸æ§åˆ¶ã€ä¸å¹²é¢„å…·ä½“çš„æ–‡æœ¬ç”Ÿæˆè¿‡ç¨‹ï¼Œä¸”ä¸å­˜å‚¨ä»»ä½•ç”Ÿæˆå†…å®¹ï¼Œå› æ­¤æœ¬ç«™å¯¹ç”¨æˆ·ç”Ÿæˆçš„ä»»ä½•å†…å®¹çš„åˆæ³•æ€§ã€å‡†ç¡®æ€§ã€å®Œæ•´æ€§ã€é€‚ç”¨æ€§åŠäº§ç”Ÿçš„ä»»ä½•ç›´æ¥æˆ–é—´æ¥åæœï¼Œä¸æ‰¿æ‹…ä»»ä½•æ³•å¾‹è´£ä»»ã€‚
            </p>
            <p><strong>3.2 æœåŠ¡ç¨³å®šæ€§ï¼š</strong>æœ¬ç«™å°½åŠ›ä¸ºæ‚¨æä¾›ç¨³å®šçš„æŠ€æœ¯æœåŠ¡ï¼Œä½†å¯¹äºæœåŠ¡çš„ä¸­æ–­ã€ç»ˆæ­¢æˆ–å‡ºç°çš„ç¼ºé™·ï¼Œæœ¬ç«™ä¸æ‰¿æ‹…è´£ä»»ã€‚æŠ€æœ¯æœåŠ¡ä¾èµ–äºç¬¬ä¸‰æ–¹APIï¼Œå…¶ç¨³å®šæ€§ä¸å¯ç”¨æ€§ä¸åœ¨æœ¬ç«™æ§åˆ¶èŒƒå›´å†…ã€‚</p>
            <p><strong>3.3 é—´æ¥æŸå¤±ï¼š</strong>åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæœ¬ç«™å‡ä¸å¯¹ä»»ä½•é—´æ¥æ€§ã€åæœæ€§ã€æƒ©ç½šæ€§ã€å¶ç„¶æ€§çš„æŸå®³æ‰¿æ‹…è´£ä»»ã€‚</p>
          </section>

          <section class="agreement-section">
            <h3>å››ã€ ä¾µæƒæŠ•è¯‰ä¸ç”¨æˆ·è¿è§„å¤„ç†</h3>
            <p><strong>4.1</strong> å¦‚æ‚¨è®¤ä¸ºæœ¬ç½‘ç«™ç”¨æˆ·ç”Ÿæˆçš„å†…å®¹ä¾µçŠ¯äº†æ‚¨çš„åˆæ³•æƒç›Šï¼Œè¯·ç«‹å³é€šè¿‡æœ¬ç«™å…¬å¸ƒçš„è”ç³»æ–¹å¼è”ç³»æˆ‘ä»¬ï¼Œå¹¶æä¾›ç›¸å…³è¯æ®ã€‚æˆ‘ä»¬å°†åœ¨æ ¸å®ååŠæ—¶å¤„ç†ã€‚</p>
            <p><strong>4.2</strong> å¦‚æœæˆ‘ä»¬è‡ªè¡Œå‘ç°æˆ–æ ¹æ®ç¬¬ä¸‰æ–¹æŠ•è¯‰/é€šçŸ¥ï¼Œè®¤å®šç”¨æˆ·è¿åäº†æœ¬åè®®çš„è§„å®šï¼Œæˆ‘ä»¬æœ‰æƒç«‹å³ç»ˆæ­¢å‘è¯¥ç”¨æˆ·æä¾›æœåŠ¡ï¼Œä¸”ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚</p>
          </section>

          <section class="agreement-section">
            <h3>äº”ã€ å…¶ä»–</h3>
            <p><strong>5.1</strong> æœ¬ç«™ä¿ç•™éšæ—¶ä¿®æ”¹æœ¬åè®®æ¡æ¬¾çš„æƒåˆ©ã€‚ä¿®æ”¹åçš„åè®®å°†åœ¨æœ¬ç«™å…¬å¸ƒåç«‹å³ç”Ÿæ•ˆã€‚æ‚¨ç»§ç»­ä½¿ç”¨æœ¬æœåŠ¡å³è§†ä¸ºæ¥å—ä¿®æ”¹åçš„åè®®ã€‚</p>
            <p><strong>5.2</strong>
              æœ¬åè®®çš„è®¢ç«‹ã€æ‰§è¡Œå’Œè§£é‡ŠåŠäº‰è®®çš„è§£å†³å‡åº”é€‚ç”¨ä¸­åäººæ°‘å…±å’Œå›½æ³•å¾‹ã€‚å¦‚åŒæ–¹å°±æœ¬åè®®å†…å®¹æˆ–å…¶æ‰§è¡Œå‘ç”Ÿä»»ä½•äº‰è®®ï¼Œåº”é¦–å…ˆå‹å¥½åå•†è§£å†³ï¼›åå•†ä¸æˆæ—¶ï¼ŒåŒæ–¹åŒæ„å°†äº‰è®®æäº¤è‡³æœ¬ç«™è¿è¥æ–¹æ‰€åœ¨åœ°æœ‰ç®¡è¾–æƒçš„äººæ°‘æ³•é™¢è¯‰è®¼è§£å†³ã€‚</p>
          </section>

          <div class="agreement-footer">
            <p class="effective-date">æœ€åæ›´æ–°æ—¥æœŸï¼š2025å¹´12æœˆ</p>
            <p class="contact-info">å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ï¼šä¸çŸ¥é“</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div class="footer-note">
          <p><strong>æ³¨æ„ï¼š</strong>è¯·å®Œæ•´é˜…è¯»å¹¶ç†è§£ä»¥ä¸Šæ‰€æœ‰æ¡æ¬¾å†…å®¹ã€‚æ»šåŠ¨åˆ°åº•éƒ¨å"åŒæ„å¹¶ç»§ç»­"æŒ‰é’®å°†å¯ç”¨ã€‚</p>
          <button v-if="isScrollingModal" @click="scrollToBottom" class="btn-scroll-bottom">
            ğŸ“œ å¿«é€Ÿæ»šåŠ¨åˆ°åº•éƒ¨
          </button>
        </div>
        <div class="footer-actions">
          <button @click="handleReject" class="btn-reject">
            æ‹’ç»å¹¶ç¦»å¼€
          </button>
          <button @click="handleAccept" :disabled="isScrollingModal"
            :class="{ 'btn-agree': true, 'disabled': isScrollingModal }">
            {{ isScrollingModal ? 'è¯·é˜…è¯»å®Œæ•´å†…å®¹' : 'âœ… åŒæ„å¹¶ç»§ç»­ä½¿ç”¨' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: 'UserAgreement',
  props: {
    showAgreementModal: {
      type: Boolean,
      default: false
    }
  },
  data() {
    return {
      scrollProgress: 0,
      isScrollingModal: true
    }
  },
  watch: {
    showAgreementModal(newVal) {
      if (newVal) {
        this.$nextTick(() => {
          const modalContent = this.$refs.modalContent;
          if (modalContent) {
            modalContent.scrollTop = 0;
            this.scrollProgress = 0;
            this.isScrollingModal = true;
          }
        });
      }
    }
  },
  methods: {
    onModalScroll(event) {
      const modalContent = event.target;
      const scrollTop = modalContent.scrollTop;
      const scrollHeight = modalContent.scrollHeight;
      const clientHeight = modalContent.clientHeight;

      const progress = (scrollTop / (scrollHeight - clientHeight)) * 100;
      this.scrollProgress = Math.min(100, Math.max(0, progress));
      this.isScrollingModal = scrollHeight - scrollTop > clientHeight + 10;
    },
    handleAccept() {
      const modalContent = this.$refs.modalContent;
      if (modalContent) {
        const isAtBottom = modalContent.scrollHeight - modalContent.scrollTop <= modalContent.clientHeight + 10;

        if (!isAtBottom) {
          alert('è¯·å…ˆé˜…è¯»å®Œæ•´çš„ç”¨æˆ·åè®®å†…å®¹è‡³åº•éƒ¨ï¼Œç„¶åæ‰èƒ½åŒæ„ã€‚');
          return;
        }
      }

      this.$emit('accept');
    },
    handleReject() {
      alert('è¦ä½¿ç”¨DeepSeekå°è¯´ç”Ÿæˆæ¡†æ¶ï¼Œæ‚¨å¿…é¡»åŒæ„ç”¨æˆ·åè®®ã€‚');
      const modalContent = this.$refs.modalContent;
      if (modalContent) {
        modalContent.scrollTop = 0;
        this.scrollProgress = 0;
        this.isScrollingModal = true;
      }
      this.$emit('reject');
    },
    scrollToBottom() {
      const modalContent = this.$refs.modalContent;
      if (modalContent) {
        modalContent.scrollTop = modalContent.scrollHeight;
        this.scrollProgress = 100;
        this.isScrollingModal = false;
      }
    }
  }
}
</script>

<style scoped>
.agreement-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(5px);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

.agreement-modal {
  background: white;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  width: 100%;
  max-width: 900px;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border: 2px solid #3498db;
  animation: slideUp 0.4s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-header {
  background: linear-gradient(135deg, #2c3e50, #4a6572);
  color: white;
  padding: 20px 30px;
  border-bottom: 3px solid #3498db;
}

.modal-header h2 {
  margin: 0 0 15px 0;
  font-size: 1.5rem;
  text-align: center;
}

.scroll-progress {
  display: flex;
  align-items: center;
  gap: 15px;
  background: rgba(255, 255, 255, 0.1);
  padding: 10px 15px;
  border-radius: 8px;
}

.progress-bar {
  flex: 1;
  height: 8px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #3498db, #9b59b6);
  border-radius: 4px;
  transition: width 0.3s ease;
}

.progress-text {
  font-size: 14px;
  font-weight: 600;
  min-width: 100px;
  text-align: right;
}

.modal-content {
  flex: 1;
  overflow-y: auto;
  padding: 25px 30px;
  background: #f8fafc;
}

.agreement-content {
  max-width: 800px;
  margin: 0 auto;
}

.important-note {
  background: #fff3cd;
  border-left: 4px solid #ffc107;
  padding: 15px 20px;
  margin-bottom: 25px;
  border-radius: 0 8px 8px 0;
}

.important-note strong {
  color: #856404;
}

.agreement-section {
  margin-bottom: 30px;
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  border-left: 4px solid #3498db;
}

.agreement-section h3 {
  color: #2c3e50;
  margin-top: 0;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 2px solid #eaeaea;
}

.agreement-section p {
  line-height: 1.7;
  margin-bottom: 12px;
  color: #333;
}

.prohibited-list {
  margin: 15px 0 15px 20px;
  padding: 0;
}

.prohibited-list li {
  margin-bottom: 10px;
  line-height: 1.6;
  padding-left: 5px;
}

.agreement-footer {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 2px solid #eaeaea;
  text-align: center;
  color: #666;
  font-size: 14px;
}

.effective-date {
  font-weight: 600;
  color: #2c3e50;
}

.contact-info {
  margin-top: 5px;
}

.modal-footer {
  background: #f8f9fa;
  padding: 20px 30px;
  border-top: 2px solid #eaeaea;
}

.footer-note {
  text-align: center;
  margin-bottom: 20px;
  padding: 15px;
  background: #e9ecef;
  border-radius: 8px;
  font-size: 14px;
}

.footer-note strong {
  color: #e74c3c;
}

.footer-actions {
  display: flex;
  justify-content: center;
  gap: 20px;
}

.btn-reject {
  padding: 12px 30px;
  background: linear-gradient(135deg, #95a5a6, #7f8c8d);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  min-width: 180px;
}

.btn-reject:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(149, 165, 166, 0.3);
}

.btn-agree {
  padding: 12px 30px;
  background: linear-gradient(135deg, #27ae60, #219a52);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  min-width: 200px;
}

.btn-agree:not(.disabled):hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
}

.btn-agree.disabled {
  background: linear-gradient(135deg, #bdc3c7, #95a5a6);
  cursor: not-allowed;
  opacity: 0.7;
}

.btn-scroll-bottom {
  padding: 8px 16px;
  background: #3498db;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  margin-top: 10px;
  transition: all 0.3s;
}

.btn-scroll-bottom:hover {
  background: #2980b9;
  transform: translateY(-1px);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 767px) {
  .agreement-modal {
    max-height: 85vh;
    margin: 10px;
  }

  .modal-header {
    padding: 15px 20px;
  }

  .modal-header h2 {
    font-size: 1.2rem;
  }

  .modal-content {
    padding: 15px 20px;
  }

  .agreement-section {
    padding: 15px;
  }

  .footer-actions {
    flex-direction: column;
    gap: 10px;
  }

  .btn-reject,
  .btn-agree {
    width: 100%;
    min-width: auto;
  }

  .scroll-progress {
    flex-direction: column;
    gap: 10px;
  }

  .progress-text {
    text-align: center;
    min-width: auto;
  }
}
</style>